<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Two-Step Booking Calendar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      background: #f5f5f5;
    }
    h2 {
      text-align: center;
    }
    .calendar-header, .week-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .calendar-header button, .week-header button {
      padding: 0.3rem 1rem;
      background-color: #007aff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    table.calendar {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    table.calendar th, table.calendar td {
      width: 14.28%;
      height: 40px;
      text-align: center;
      cursor: pointer;
      border: 1px solid #ddd;
    }
    table.calendar td.selected {
      background-color: #007aff;
      color: white;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .time-slot-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .time-slot {
      padding: 0.5rem 1rem;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
    }
    .time-slot.selected {
      background: #007aff;
      color: white;
    }
  </style>
</head>
<body>

<h2>Select a Date</h2>
<div id="dateSelection">
  <div class="calendar-header">
    <button id="prevMonth">&lt;</button>
    <span id="monthLabel"></span>
    <button id="nextMonth">&gt;</button>
  </div>
  <table class="calendar">
    <thead>
      <tr>
        <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
      </tr>
    </thead>
    <tbody id="calendarBody"></tbody>
  </table>
</div>

<div id="timeSelection" class="hidden">
  <div class="week-header">
    <button id="prevWeek">&lt; Previous Week</button>
    <span id="weekLabel"></span>
    <button id="nextWeek">Next Week &gt;</button>
  </div>
  <div id="timeSlots" class="time-slot-grid"></div>
</div>

<script>
  const calendarBody = document.getElementById('calendarBody');
  const monthLabel = document.getElementById('monthLabel');
  const timeSelection = document.getElementById('timeSelection');
  const dateSelection = document.getElementById('dateSelection');
  const timeSlotsContainer = document.getElementById('timeSlots');
  const weekLabel = document.getElementById('weekLabel');

  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let selectedDate = null;

  document.getElementById('prevMonth').onclick = () => {
    if (currentMonth === 0) {
      currentMonth = 11;
      currentYear--;
    } else {
      currentMonth--;
    }
    renderCalendar();
  };

  document.getElementById('nextMonth').onclick = () => {
    if (currentMonth === 11) {
      currentMonth = 0;
      currentYear++;
    } else {
      currentMonth++;
    }
    renderCalendar();
  };

  function renderCalendar() {
    calendarBody.innerHTML = '';
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    monthLabel.textContent = new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' });

    let row = document.createElement('tr');
    for (let i = 0; i < firstDay; i++) {
      row.appendChild(document.createElement('td'));
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement('td');
      cell.textContent = day;
      const date = new Date(currentYear, currentMonth, day);

      cell.onclick = () => {
        selectedDate = date;
        dateSelection.classList.add('hidden');
        timeSelection.classList.remove('hidden');
        renderWeek(date);
      };

      row.appendChild(cell);

      if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
        calendarBody.appendChild(row);
        row = document.createElement('tr');
      }
    }
  }

  function renderWeek(date) {
    const start = new Date(date);
    start.setDate(date.getDate() - date.getDay()); // Sunday
    weekLabel.textContent = `${start.toDateString()} - ${new Date(start.getFullYear(), start.getMonth(), start.getDate() + 6).toDateString()}`;

    timeSlotsContainer.innerHTML = '';
    const timeSlots = generateTimeSlots();

    for (let i = 0; i < 7; i++) {
      const current = new Date(start);
      current.setDate(start.getDate() + i);

      const dayLabel = document.createElement('div');
      dayLabel.innerHTML = `<strong>${current.toDateString()}</strong>`;
      timeSlotsContainer.appendChild(dayLabel);

      timeSlots.forEach(slot => {
        const block = document.createElement('div');
        block.className = 'time-slot';
        block.textContent = `${slot}`;
        block.onclick = () => block.classList.toggle('selected');
        timeSlotsContainer.appendChild(block);
      });
    }
  }

  function generateTimeSlots() {
    const slots = [];
    let hour = 8;
    let minute = 0;
    while (hour < 18) {
      const h = hour % 12 || 12;
      const ampm = hour < 12 ? 'AM' : 'PM';
      slots.push(`${h}:${minute.toString().padStart(2, '0')} ${ampm}`);
      minute += 30;
      if (minute === 60) {
        minute = 0;
        hour++;
      }
    }
    return slots;
  }

  document.getElementById('prevWeek').onclick = () => {
    selectedDate.setDate(selectedDate.getDate() - 7);
    renderWeek(selectedDate);
  };

  document.getElementById('nextWeek').onclick = () => {
    selectedDate.setDate(selectedDate.getDate() + 7);
    renderWeek(selectedDate);
  };

  renderCalendar();
</script>

</body>
</html>
