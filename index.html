<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Select Dates</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 480px;
    margin: 2rem auto;
    padding: 0 1rem;
    background: #f9f9f9;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  .calendar-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  button {
    padding: 0.4rem 1rem;
    cursor: pointer;
    border: none;
    background: #007aff;
    color: white;
    border-radius: 4px;
  }
  #monthLabel {
    font-weight: bold;
  }
  .calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.2rem;
    background: white;
    padding: 0.5rem;
    border-radius: 8px;
    box-shadow: 0 0 5px #ccc;
  }
  .day-name, .day {
    text-align: center;
    padding: 0.5rem 0;
  }
  .day-name {
    font-weight: bold;
    color: #555;
  }
  .day {
    cursor: pointer;
    border-radius: 6px;
    user-select: none;
  }
  .day:hover:not(.disabled):not(.selected) {
    background: #d0e7ff;
  }
  .day.disabled {
    color: #aaa;
    cursor: default;
  }
  .day.selected {
    background: #007aff;
    color: white;
    font-weight: bold;
  }
  .next-button {
    margin-top: 1rem;
    width: 100%;
    background: #007aff;
    color: white;
    padding: 0.75rem;
    font-size: 1.1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .next-button:disabled {
    background: #99caff;
    cursor: default;
  }
</style>
</head>
<body>

<h1>Select One or More Dates</h1>
<div class="calendar-controls">
  <button id="prevMonth">&lt; Prev</button>
  <div id="monthLabel"></div>
  <button id="nextMonth">Next &gt;</button>
</div>
<div class="calendar" id="calendar"></div>
<button class="next-button" id="nextButton" disabled>Next: Select Time Blocks</button>

<script>
  const calendar = document.getElementById('calendar');
  const monthLabel = document.getElementById('monthLabel');
  const prevBtn = document.getElementById('prevMonth');
  const nextBtn = document.getElementById('nextMonth');
  const nextButton = document.getElementById('nextButton');

  let currentDate = new Date();
  let selectedDates = new Set(JSON.parse(localStorage.getItem('selectedDates') || "[]").map(d => new Date(d).toDateString()));

  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

  function renderCalendar(date) {
    calendar.innerHTML = '';
    monthLabel.textContent = date.toLocaleString('default', { month: 'long', year: 'numeric' });

    // Render day names
    dayNames.forEach(dn => {
      const dnDiv = document.createElement('div');
      dnDiv.textContent = dn;
      dnDiv.className = 'day-name';
      calendar.appendChild(dnDiv);
    });

    const year = date.getFullYear();
    const month = date.getMonth();

    const firstDayOfMonth = new Date(year, month, 1);
    const lastDayOfMonth = new Date(year, month + 1, 0);

    const startWeekday = firstDayOfMonth.getDay();
    const daysInMonth = lastDayOfMonth.getDate();

    // Fill in blanks before first day
    for(let i=0; i<startWeekday; i++){
      const emptyCell = document.createElement('div');
      emptyCell.className = 'day disabled';
      calendar.appendChild(emptyCell);
    }

    for(let day=1; day <= daysInMonth; day++) {
      const dayDate = new Date(year, month, day);
      const dayDiv = document.createElement('div');
      dayDiv.textContent = day;
      dayDiv.className = 'day';
      if(selectedDates.has(dayDate.toDateString())) {
        dayDiv.classList.add('selected');
      }

      // Disable past dates (before today)
      const today = new Date();
      today.setHours(0,0,0,0);
      if(dayDate < today) {
        dayDiv.classList.add('disabled');
      } else {
        dayDiv.addEventListener('click', () => {
          if(dayDiv.classList.contains('selected')) {
            dayDiv.classList.remove('selected');
            selectedDates.delete(dayDate.toDateString());
          } else {
            dayDiv.classList.add('selected');
            selectedDates.add(dayDate.toDateString());
          }
          updateLocalStorage();
          updateNextButton();
        });
      }

      calendar.appendChild(dayDiv);
    }

    updateNextButton();
  }

  function updateLocalStorage() {
    localStorage.setItem('selectedDates', JSON.stringify(Array.from(selectedDates)));
  }

  function updateNextButton() {
    nextButton.disabled = selectedDates.size === 0;
  }

  prevBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
  });

  nextBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
  });

  nextButton.addEventListener('click', () => {
    if(selectedDates.size > 0) {
      window.location.href = 'time.html';
    }
  });

  renderCalendar(currentDate);
</script>

</body>
</html>
