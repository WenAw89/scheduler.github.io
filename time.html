<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pick Time Slots per Date</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 2rem auto; padding: 1rem; background: #f5f5f5; }
    h2 { text-align: center; }
    .date-section { background: white; padding: 1rem; margin-bottom: 1.5rem; border-radius: 6px; box-shadow: 0 0 6px #ccc; }
    .date-title { font-weight: bold; margin-bottom: 0.5rem; }
    .time-blocks { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .time-block {
      padding: 0.4rem 0.8rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: white;
      cursor: pointer;
      user-select: none;
    }
    .time-block.selected {
      background-color: #007aff;
      color: white;
      font-weight: bold;
    }
    button {
      width: 100%;
      padding: 0.75rem;
      font-size: 1.1rem;
      background: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Select Time Blocks for Each Date</h2>
  <div id="dateTimeContainer"></div>
  <button id="submitBtn">Submit Booking</button>

<script>
const timeSlots = () => {
  const slots = [];
  let hour = 7, minute = 30;
  while (hour < 20 || (hour === 20 && minute === 0)) {
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const displayHour = hour % 12 || 12;
    slots.push(`${displayHour}:${minute.toString().padStart(2,'0')} ${ampm}`);
    minute += 30;
    if (minute === 60) {
      minute = 0;
      hour++;
    }
  }
  return slots;
};

const selectedDates = JSON.parse(localStorage.getItem('selectedDates') || '[]');
if (selectedDates.length === 0) {
  alert('Please select dates first.');
  window.location.href = 'index.html';
}

const dateTimeSelections = {};
const container = document.getElementById('dateTimeContainer');
const slots = timeSlots();

selectedDates.forEach(date => {
  const section = document.createElement('div');
  section.className = 'date-section';

  const title = document.createElement('div');
  title.className = 'date-title';
  title.textContent = date;

  const blocksDiv = document.createElement('div');
  blocksDiv.className = 'time-blocks';

  dateTimeSelections[date] = [];

  slots.forEach(time => {
    const block = document.createElement('div');
    block.className = 'time-block';
    block.textContent = time;
    block.onclick = () => {
      block.classList.toggle('selected');
      if (dateTimeSelections[date].includes(time)) {
        dateTimeSelections[date] = dateTimeSelections[date].filter(t => t !== time);
      } else {
        dateTimeSelections[date].push(time);
      }
    };
    blocksDiv.appendChild(block);
  });

  section.appendChild(title);
  section.appendChild(blocksDiv);
  container.appendChild(section);
});

document.getElementById('submitBtn').onclick = () => {
  const name = prompt("Enter your full name:");
  const email = prompt("Enter your email:");
  const phone = prompt("Enter your phone number:");
  const address = prompt("Enter your address:");
  const pets = prompt("Tell me about your pets:");

  const formattedSelections = selectedDates.map(date => {
    const times = dateTimeSelections[date].join(', ');
    return `${date}: ${times}`;
  }).join('\n');

  const formURL = new URL("https://docs.google.com/forms/d/e/1FAIpQLSeei3yQ8YRVchlSk5gnQiVmcZTJKfGaf-O4m9fB72FjAqmudQ/viewform");
  formURL.searchParams.set("entry.2005620554", name);
  formURL.searchParams.set("entry.1045781291", email);
  formURL.searchParams.set("entry.1065046570", address);
  formURL.searchParams.set("entry.1166974658", phone);
  formURL.searchParams.set("entry.839337160", selectedDates.join(', '));
  formURL.searchParams.set("entry.1726420148", formattedSelections);
  formURL.searchParams.set("entry.2080923976", pets);

  // Redirect to Google Form with prefilled info
  window.location.href = formURL.toString();
};
</script>
</body>
</html>
